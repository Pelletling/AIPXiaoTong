@using AIPXiaoTong.Model.Site;
@using AIPXiaoTong.Model;

@{
    var merInfo = ViewBag.merInfo;
    var districtNameList = ViewBag.DistrictNameList as List<DistrictManagementLM>;

    var provinceList = (ViewBag.AreaList as List<AreaModel>).Where(t => t.Level == 1).OrderBy(t => t.Name).ToList();
    var cityList = (ViewBag.AreaList as List<AreaModel>).Where(t => t.Level == 2 && t.ParentCode == Model.ProvinceCode).OrderBy(t => t.Name).ToList();
}
@model ProjectManagementCM

<script src="~/Scripts/uploadifive/jquery.uploadifive.min.js"></script>

<div class="page-container page-container-custom">
    <form action="" method="post" class="form form-horizontal" id="CreateFrom">
        @Html.HiddenFor(t => t.ID)
        @Html.AntiForgeryToken()

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>项目名称：</label>
            <div class="formControls col-xs-8 col-sm-9">
                @Html.TextBoxFor(t => t.ProjetName, new { @class = "input-text", placeholder = "" })
                @Html.ValidationMessageFor(t => t.ProjetName)
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>截止日期：</label>
            <div class="formControls col-xs-8 col-sm-9">
                @Html.TextBoxFor(t => t.Deadline, new { @class = "input-text", placeholder = "", @onfocus = "WdatePicker({ lang: 'zh-cn', dateFmt: 'yyyy-MM-dd' })", Value = Model.Deadline.ToString() != "0001/1/1 0:00:00" ? Model.Deadline.ToString("yyyy-MM-dd") : "" })
                @Html.ValidationMessageFor(t => t.Deadline)
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>项目金额：</label>
            <div class="formControls col-xs-8 col-sm-9">
                @Html.TextBoxFor(t => t.ProjectAmount, new { @class = "input-text", placeholder = "" })
                @Html.ValidationMessageFor(t => t.ProjectAmount)
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>项目所在区域：</label>
            <div class="formControls col-xs-4 col-sm-2">
                <span class="select-box">
                    @Html.DropDownListFor(t => t.ProvinceCode, provinceList.Select(p => new SelectListItem { Value = p.Code, Text = p.Name }), "", new { @class = "select", placeholder = "ads" })
                </span>
                @Html.ValidationMessageFor(t => t.ProvinceCode)
            </div>
            <div class="formControls col-xs-4 col-sm-2">
                <span class="select-box">
                    @Html.DropDownListFor(t => t.CityCode, cityList.Select(p => new SelectListItem { Value = p.Code, Text = p.Name }), "", new { @class = "select" })
                </span>
                @Html.ValidationMessageFor(t => t.CityCode)
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>项目图片：</label>
            <div class="formControls col-xs-3 col-sm-1">
                @Html.Hidden("ProjectImage", Model.ProjectImage)
                <input type="button" id="uploadProjectImage" name="uploadProjectImage" data-iamgeid="ProjectImage" data-imagepath="ProjectImage">
            </div>
            <label class="form-label col-xs-4 col-sm-3" style="color:red;text-align:left;"> 仅支持图片格式为jpg或png，建议图片长宽比例4:3</label>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>广告图片：</label>
            <div class="formControls col-xs-3 col-sm-1" id="AdvertisingImg">
                <input type="button" id="uploadAdvertisingImg" name="uploadAdvertisingImg" data-iamgeid="AdvertisingImg" data-imagepath="AdvertisingImg">
            </div>
            <label class="form-label col-xs-5 col-sm-4" style="color:red;text-align:left;"> 最多可上传3张，建议图片格式为jpg或png</label>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">剩余认筹额度：</label>
            <div class="formControls col-xs-8 col-sm-9">
                @Html.TextBoxFor(t => t.ResidueAmount, new { @class = "input-text", placeholder = "" })
                @Html.ValidationMessageFor(t => t.ResidueAmount)
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">简短描述：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <textarea class="input-text" style="height:60px;" id="Description" name="Description" rows="2" cols="20" placeholder="60字以内"></textarea>
            </div>
        </div>

        @Html.Partial("_Save", new EntityModel() { ID = Model.ID, Status = Model.Status })

    </form>
</div>

<script>
    $(function () {

        $("#uploadProjectImage").uploadifive({
            'fileSizeLimit': 1024,
            'fileType': '*.*',
            'width': '90',
            'buttonClass': 'btn btn-primary radio',
            'buttonText': '上传图片',
            'auto': true,
            'uploadScript': '/ProjectManagement/UploadFile',

            'onUploadError': function (file, errorCode, errorMsg, errorString) {
                alert(errorCode + ',' + errorMsg + ',' + errorString);
            },
            'onUploadComplete': function (file, data) {
                var json = JSON.parse(data);
                if (json.Msg != "") {
                    alert(json.Msg);
                }
                else {
                    $("#ProjectImage").val(json.Path);
                }
            }

        });


        $("#uploadAdvertisingImg").uploadifive({
            'fileSizeLimit': 1024,
            'fileType': '*.*',
            'width': '90',
            'buttonClass': 'btn btn-primary radio',
            'buttonText': '上传文件',
            'auto': true,
            'uploadScript': '/ProjectManagement/UploadAdvertisingImge',

            'onUploadError': function (file, errorCode, errorMsg, errorString) {
                alert(errorCode + ',' + errorMsg + ',' + errorString);
            },
            'onUploadComplete': function (file, data) {
                var json = JSON.parse(data);
                if (json.Msg != "") {
                    alert(json.Msg);
                }
                else {
                    $("#AdvertisingImg").append('<input type="hidden" name="AdvertisingImgList" value="' + json.Path + '" />');
                }
            }
        });


        BindProvince();
        BindCity();
    });

</script>


